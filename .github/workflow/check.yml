name: Check Student Exercises

# This workflow runs automatically when students create a pull request
# It tests their code to make sure everything works correctly!

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    # Step 1: Get the code from the pull request
    - name: 📥 Checkout code
      uses: actions/checkout@v3

    # Step 2: Set up Python environment
    - name: 🐍 Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # Step 3: Show students what's happening
    - name: 👋 Welcome Message
      run: |
        echo "=================================="
        echo "🤖 Starting Automated Tests!"
        echo "=================================="
        echo ""
        echo "Your code will now be tested automatically."
        echo "Don't worry if tests fail - that's how we learn!"
        echo ""

    # Step 4: Run basic calculator tests
    - name: 🧮 Test Calculator Functions
      run: |
        echo "Testing Calculator..."
        python tests/test_calculator.py
      continue-on-error: false

    # Step 5: Run basic greeting tests
    - name: 👋 Test Greeting Functions
      run: |
        echo "Testing Greeting Functions..."
        python tests/test_greeting.py
      continue-on-error: false

    # Step 6: Run basic student info tests
    - name: 📚 Test Student Info Functions
      run: |
        echo "Testing Student Info Functions..."
        python tests/test_student_info.py
      continue-on-error: false

    # Step 7: Celebrate if basic tests pass!
    - name: 🎉 Basic Tests Passed!
      if: success()
      run: |
        echo ""
        echo "=================================="
        echo "✅ Great job! Basic tests passed!"
        echo "=================================="
        echo ""
        echo "Now let's check some edge cases..."
        echo ""

    # Step 8: Run hidden calculator tests (edge cases)
    - name: 🔍 Hidden Test - Calculator Edge Cases
      run: |
        echo "Running hidden calculator tests..."
        python hidden_tests/test_calculator_advanced.py
      continue-on-error: true

    # Step 9: Run hidden greeting tests (edge cases)
    - name: 🔍 Hidden Test - Greeting Edge Cases
      run: |
        echo "Running hidden greeting tests..."
        python hidden_tests/test_greeting_advanced.py
      continue-on-error: true

    # Step 10: Run hidden student info tests (boundary cases)
    - name: 🔍 Hidden Test - Student Info Edge Cases
      run: |
        echo "Running hidden student info tests..."
        python hidden_tests/test_student_info_advanced.py
      continue-on-error: true

    # Step 11: Final success message
    - name: 🎊 Success Message
      if: success()
      run: |
        echo ""
        echo "=========================================="
        echo "🎉 CONGRATULATIONS! 🎉"
        echo "=========================================="
        echo ""
        echo "All tests passed - including hidden ones!"
        echo "Your code is ready to merge!"
        echo ""
        echo "What you accomplished:"
        echo "  ✅ Fixed all bugs in calculator functions"
        echo "  ✅ Completed all greeting functions"
        echo "  ✅ Fixed all logic errors in student info"
        echo "  ✅ Handled edge cases correctly"
        echo ""
        echo "You're now ready for more advanced projects!"
        echo ""
        echo "=========================================="

    # Step 12: Helpful message if tests fail
    - name: 💡 Help Message
      if: failure()
      run: |
        echo ""
        echo "=========================================="
        echo "⚠️  Some tests didn't pass yet"
        echo "=========================================="
        echo ""
        echo "Don't worry! This is part of learning."
        echo ""
        echo "What to do next:"
        echo "  1. Read the error messages above carefully"
        echo "  2. They tell you exactly what's wrong"
        echo "  3. Fix the issues in your code"
        echo "  4. Test locally: python tests/test_*.py"
        echo "  5. Commit and push your fixes"
        echo "  6. The tests will run again automatically!"
        echo ""
        echo "💪 You got this!"
        echo ""
        echo "=========================================="
